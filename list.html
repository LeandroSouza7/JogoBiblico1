<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	
		<link href="css/estilo.css" rel="stylesheet">

        <style>

            .btnVoltarTela{
                border: solid 2px black;
                position: absolute;
                bottom: 20px;
                right: 20px;
                padding: 10px;
                cursor: pointer;
            }
        </style>

    </head>
    <body>

        <input type="text" class="textInput"> <button class="btnPersonagem btn">Enviar Personagem</button>
        <input type="number" class="textId"> <button class="btnId btn">Enviar ID</button>

        <div class="listPersonagens">
            <ul class="ulPersonagens">
            </ul>
        </div>

        <div class="none btnVoltarTela"><btn>Voltar lista completa</btn></div>

        <script>
            const $ulPersonagens = document.querySelector('.ulPersonagens');
            const $inputText = document.querySelector('.textInput');
            const $inputId = document.querySelector('.textId');
            const $btnPersonagem = document.querySelector('.btnPersonagem');
            const $btnId = document.querySelector('.btnId');
            const $btnVoltarTela = document.querySelector('.btnVoltarTela')

            if($inputText.value === "" && $inputId.value === ""){
                ajaxGet();
            }


            function ajaxGet(){
                let xhr = new XMLHttpRequest();
                let url = "http://localhost:3000/perguntas";
                xhr.open("GET", url);
                xhr.setRequestHeader("Content-type", "application/json;charset=UTF-8");
                xhr.send(null);
                xhr.onreadystatechange = verificaAjax;

                function verificaAjax(){
                    if(xhr.readyState === 4){
                        if(xhr.status < 400){
                            const json = JSON.parse(xhr.responseText);
                            viewList(json);
                        }else{
                            alert("Deu ruim");
                        }
                    }
                }
            }

                

                function viewList(list){ 
                    $ulPersonagens.innerHTML = "";
                    const l = list[0];
                    var x = 0;
                    while(x < list.length){
                        const $li = document.createElement('li');
                        let i = 0;
                        i += x;
                        let text = document.createTextNode(list[i].id + " " + list[x].personagem);
                        $li.appendChild(text); 
                        $ulPersonagens.appendChild($li);
                        x++;
                    }

                    $btnPersonagem.addEventListener('click', function(){
                        let personagemProcurado = $inputText.value;

                        personagemProcurado = personagemProcurado.toLowerCase();

                        if(personagemProcurado == ""){
                            alert("Input vazio");
                            return
                        }

                        let qtdPersonagens = list.length;
                        let x = 0;
                        while(x < list.length){
                            let personagens = list[x].personagem;
                            personagens = personagens.toLowerCase();
                            if(personagemProcurado === personagens){
                                $ulPersonagens.innerHTML = `<li>${list[x].id} ${list[x].personagem}`;
                                $inputText.value = "";

                                $btnVoltarTela.classList.remove('none');

                                $btnVoltarTela.addEventListener('click', function(){
                                    $ulPersonagens.innerHTML = ""; 
                                    ajaxGet();
                                    $btnVoltarTela.classList.add('none');
                                })
                                return;
                            }else{
                                if(x + 1 == qtdPersonagens){
                                    alert("Personagem não encontrado");
                                    return
                                }
                            }

                            x++;
                        }

                    });

                    $btnId.addEventListener('click', function(){
                        const idProcurado = $inputId.value;

                        if(idProcurado == ""){
                            alert("Input vazio");
                            return
                        }

                        let x = 0;
                        let qtdPersonagens = list.length;
                        while(x < list.length){
                            let ids = list[x].id;
                            if(idProcurado == ids){
                                $ulPersonagens.innerHTML = `<li>${list[x].id} ${list[x].personagem}`;
                                $inputId.value = "";

                                $btnVoltarTela.classList.remove('none');

                                $btnVoltarTela.addEventListener('click', function(){
                                    $ulPersonagens.innerHTML = ""; 
                                    ajaxGet();
                                    $btnVoltarTela.classList.add('none');
                                })
                                return;
                            }else{
                                console.log(x + 1, qtdPersonagens);
                                if(x + 1 == qtdPersonagens){
                                    alert("Personagem não encontrado");
                                    return
                                }
                            }

                            x++;
                        }

                    })
                }


        </script>
    </body>
</html>